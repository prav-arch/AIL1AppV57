{% extends "base.html" %}
{% set active_tab = 'dashboard' %}

{% block title %}Dashboard - L1 Troubleshooting Platform{% endblock %}

{% block content %}
<!-- Dashboard Header -->
<div class="row">
    <div class="col-md-12">
        <div class="page-header">
            <h2><i class="fa fa-tachometer"></i> System Dashboard</h2>
            <p class="text-muted">Real-time monitoring and performance metrics for your systems</p>
        </div>
    </div>
</div>

<!-- Key Metrics Summary -->
<div class="row">
    <div class="col-md-3">
        <div class="panel panel-primary">
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-comments fa-3x text-primary"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge" id="llm-request-count">0</div>
                        <div>LLM Requests</div>
                    </div>
                </div>
                <div class="text-success" style="margin-top: 10px; font-size: 12px;">
                    <i class="fa fa-arrow-up"></i> 5% from yesterday
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="panel panel-green">
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-file-text fa-3x text-success"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge" id="docs-indexed-count">0</div>
                        <div>Documents Indexed</div>
                    </div>
                </div>
                <div class="text-success" style="margin-top: 10px; font-size: 12px;">
                    <i class="fa fa-arrow-up"></i> 12% from yesterday
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="panel panel-red">
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-exclamation-triangle fa-3x text-danger"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge" id="anomalies-count">0</div>
                        <div>Active Anomalies</div>
                    </div>
                </div>
                <div class="text-danger" style="margin-top: 10px; font-size: 12px;">
                    <i class="fa fa-arrow-up"></i> 8% from yesterday
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="panel panel-yellow">
            <div class="panel-body">
                <div class="row">
                    <div class="col-xs-3">
                        <i class="fa fa-cogs fa-3x text-warning"></i>
                    </div>
                    <div class="col-xs-9 text-right">
                        <div class="huge" id="pipelines-count">0</div>
                        <div>Active Pipelines</div>
                    </div>
                </div>
                <div class="text-muted" style="margin-top: 10px; font-size: 12px;">
                    <i class="fa fa-minus"></i> No change
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Health Panel -->
<div class="row">
    <div class="col-md-12">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-heartbeat"></i> System Health</h3>
            </div>
            <div class="panel-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="panel panel-default">
                            <div class="panel-body text-center">
                                <div class="knob-container">
                                    <div class="knob-label">Memory</div>
                                    <div class="progress">
                                        <div id="memory-usage" class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 75%;">
                                            75%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
                            <div class="panel-body text-center">
                                <div class="knob-container">
                                    <div class="knob-label">CPU</div>
                                    <div class="progress">
                                        <div id="cpu-load" class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="42" aria-valuemin="0" aria-valuemax="100" style="width: 42%;">
                                            42%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
                            <div class="panel-body text-center">
                                <div class="knob-container">
                                    <div class="knob-label">Disk</div>
                                    <div class="progress">
                                        <div id="disk-usage" class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="68" aria-valuemin="0" aria-valuemax="100" style="width: 68%;">
                                            68%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="panel panel-default">
                            <div class="panel-body text-center">
                                <div class="knob-container">
                                    <div class="knob-label">Network</div>
                                    <div class="progress">
                                        <div id="network-throughput" class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="35" aria-valuemin="0" aria-valuemax="100" style="width: 35%;">
                                            35%
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Charts Row -->
<div class="row">
    <div class="col-md-8">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-6">
                        <h3 class="panel-title"><i class="fa fa-area-chart"></i> Performance Trends</h3>
                    </div>
                    <div class="col-md-6 text-right">
                        <div class="btn-group btn-group-xs">
                            <button type="button" class="btn btn-default active">Day</button>
                            <button type="button" class="btn btn-default">Week</button>
                            <button type="button" class="btn btn-default">Month</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div class="chart-container" style="position: relative; height:300px;">
                    <canvas id="llmUsageChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-pie-chart"></i> Resource Distribution</h3>
            </div>
            <div class="panel-body">
                <div class="chart-container" style="position: relative; height:300px;">
                    <canvas id="resourceDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- GPU and Status Lists -->
<div class="row">
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title"><i class="fa fa-microchip"></i> GPU Utilization</h3>
            </div>
            <div class="panel-body">
                <div class="chart-container" style="position: relative; height:250px;">
                    <canvas id="gpuUtilizationChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <ul class="nav nav-tabs card-header-tabs" role="tablist">
                    <li role="presentation" class="active"><a href="#kafka-tab" aria-controls="kafka-tab" role="tab" data-toggle="tab">Kafka Messages</a></li>
                    <li role="presentation"><a href="#pipeline-tab" aria-controls="pipeline-tab" role="tab" data-toggle="tab">Pipelines</a></li>
                    <li role="presentation"><a href="#anomalies-tab" aria-controls="anomalies-tab" role="tab" data-toggle="tab">Anomalies</a></li>
                </ul>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                    <!-- Kafka Messages Tab -->
                    <div role="tabpanel" class="tab-pane active" id="kafka-tab">
                        <ul class="list-group" id="recent-messages" style="max-height: 212px; overflow-y: auto; margin-bottom: 0;">
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>logs-queue</strong>
                                        <div class="text-muted small">System startup completed</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <span class="label label-primary">2m ago</span>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>metrics-queue</strong>
                                        <div class="text-muted small">CPU spike detected</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <span class="label label-primary">5m ago</span>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>alerts-queue</strong>
                                        <div class="text-muted small">New anomaly detected</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <span class="label label-danger">10m ago</span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Pipelines Tab -->
                    <div role="tabpanel" class="tab-pane" id="pipeline-tab">
                        <ul class="list-group" id="pipeline-status" style="max-height: 212px; overflow-y: auto; margin-bottom: 0;">
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>Data Ingestion</strong>
                                        <div class="text-muted small">Processing files</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <span class="label label-success">Running</span>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>ETL Process</strong>
                                        <div class="text-muted small">Transforming data</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <span class="label label-success">Running</span>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>Model Training</strong>
                                        <div class="text-muted small">Scheduled for 22:00</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <span class="label label-default">Scheduled</span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                    
                    <!-- Anomalies Tab -->
                    <div role="tabpanel" class="tab-pane" id="anomalies-tab">
                        <ul class="list-group" id="latest-anomalies" style="max-height: 212px; overflow-y: auto; margin-bottom: 0;">
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>Network Traffic Spike</strong>
                                        <div class="text-muted small">Unusual outbound traffic</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <a href="/anomalies" class="btn btn-xs btn-primary">Details</a>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>Memory Leak</strong>
                                        <div class="text-muted small">In application server</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <a href="/anomalies" class="btn btn-xs btn-primary">Details</a>
                                    </div>
                                </div>
                            </li>
                            <li class="list-group-item">
                                <div class="row">
                                    <div class="col-xs-8">
                                        <strong>API Response Time</strong>
                                        <div class="text-muted small">Increased latency detected</div>
                                    </div>
                                    <div class="col-xs-4 text-right">
                                        <a href="/anomalies" class="btn btn-xs btn-primary">Details</a>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.panel-green {
    border-color: #5cb85c;
}
.panel-green .panel-heading {
    border-color: #5cb85c;
    color: white;
    background-color: #5cb85c;
}
.panel-yellow {
    border-color: #f0ad4e;
}
.panel-yellow .panel-heading {
    border-color: #f0ad4e;
    color: white;
    background-color: #f0ad4e;
}
.panel-red {
    border-color: #d9534f;
}
.panel-red .panel-heading {
    border-color: #d9534f;
    color: white;
    background-color: #d9534f;
}
.huge {
    font-size: 32px;
    font-weight: bold;
}
.knob-container {
    text-align: center;
}
.knob-label {
    font-size: 16px;
    font-weight: bold;
    margin-bottom: 10px;
}
.card-header-tabs {
    margin-right: 0;
    margin-bottom: 0;
    margin-left: 0;
    border-bottom: 0;
}
.card-header-tabs > li {
    margin-bottom: -1px;
    float: left;
}
.card-header-tabs > li > a {
    margin-right: 2px;
    line-height: 1.42857143;
    border: 1px solid transparent;
    border-radius: 4px 4px 0 0;
}
.card-header-tabs > li > a:hover {
    border-color: #eee #eee #ddd;
}
.card-header-tabs > li.active > a,
.card-header-tabs > li.active > a:hover,
.card-header-tabs > li.active > a:focus {
    color: #555;
    cursor: default;
    background-color: #fff;
    border: 1px solid #ddd;
    border-bottom-color: transparent;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// Add tab functionality
$(document).ready(function() {
    $('.nav-tabs a').click(function(e) {
        e.preventDefault();
        $(this).tab('show');
    });
});
</script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}