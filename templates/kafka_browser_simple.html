{% extends "base.html" %}
{% set active_tab = 'kafka_browser' %}

{% block title %}Kafka Browser - L1 Troubleshooting Platform{% endblock %}

{% block extra_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <div class="page-header">
                <h2><i class="fa fa-exchange"></i> Kafka Browser</h2>
            </div>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-server"></i> Broker Count</h3>
                </div>
                <div class="panel-body text-center">
                    <h2>3</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-list"></i> Total Topics</h3>
                </div>
                <div class="panel-body text-center">
                    <h2>15</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-users"></i> Consumer Groups</h3>
                </div>
                <div class="panel-body text-center">
                    <h2>12</h2>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-envelope"></i> Total Messages</h3>
                </div>
                <div class="panel-body text-center">
                    <h2>172</h2>
                </div>
            </div>
        </div>
    </div>
    
    <div class="panel panel-primary">
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-6">
                    <h3 class="panel-title"><i class="fa fa-list-alt"></i> Kafka Topics</h3>
                </div>
                <div class="col-md-6 text-right">
                    <span class="label label-info">Showing low-volume topics</span>
                </div>
            </div>
        </div>
        <div class="panel-body">
            <table class="table table-striped" id="topics-table">
                <thead>
                    <tr>
                        <th>Topic Name</th>
                        <th>Partitions</th>
                        <th>Replication</th>
                        <th>Message Count</th>
                        <th>Throughput</th>
                        <th>Size</th>
                        <th>Retention</th>
                        <th>Created</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>alerts-topic</strong></td>
                        <td>1</td>
                        <td>3</td>
                        <td class="text-muted">45</td>
                        <td>5 msg/sec</td>
                        <td>2.5 MB</td>
                        <td>90 days</td>
                        <td>2025-04-02 00:00:00</td>
                    </tr>
                    <tr>
                        <td><strong>notification-alerts</strong></td>
                        <td>2</td>
                        <td>3</td>
                        <td class="text-muted">32</td>
                        <td>3 msg/sec</td>
                        <td>1.8 MB</td>
                        <td>60 days</td>
                        <td>2025-04-15 00:00:00</td>
                    </tr>
                    <tr>
                        <td><strong>config-changes</strong></td>
                        <td>1</td>
                        <td>3</td>
                        <td class="text-muted">18</td>
                        <td>1 msg/sec</td>
                        <td>0.7 MB</td>
                        <td>180 days</td>
                        <td>2025-04-10 00:00:00</td>
                    </tr>
                    <tr>
                        <td><strong>heartbeat-signals</strong></td>
                        <td>1</td>
                        <td>3</td>
                        <td class="text-muted">48</td>
                        <td>12 msg/sec</td>
                        <td>0.3 MB</td>
                        <td>14 days</td>
                        <td>2025-04-05 00:00:00</td>
                    </tr>
                    <tr>
                        <td><strong>audit-events</strong></td>
                        <td>2</td>
                        <td>3</td>
                        <td class="text-muted">27</td>
                        <td>2 msg/sec</td>
                        <td>1.2 MB</td>
                        <td>365 days</td>
                        <td>2025-04-08 00:00:00</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-file-text"></i> Topic: alerts-topic - Messages</h3>
        </div>
        <div class="panel-body">
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">Message Count</h3>
                        </div>
                        <div class="panel-body text-center">
                            <h4>45</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">Avg Message Size</h3>
                        </div>
                        <div class="panel-body text-center">
                            <h4>0.5 KB</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">Top Partition</h3>
                        </div>
                        <div class="panel-body text-center">
                            <h4>1</h4>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="panel panel-info">
                        <div class="panel-heading">
                            <h3 class="panel-title">Message Rate</h3>
                        </div>
                        <div class="panel-body text-center">
                            <h4>5 msg/sec</h4>
                        </div>
                    </div>
                </div>
            </div>
            
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Offset</th>
                        <th>Partition</th>
                        <th>Key</th>
                        <th>Value</th>
                        <th>Timestamp</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>1000050</td>
                        <td>1</td>
                        <td><code>srv-web-01</code></td>
                        <td class="text-truncate" style="max-width:400px;">
                            <code>{"timestamp":"2025-05-22T04:55:12.000Z","level":"INFO","service":"api-gateway","message":"Request processed successfully","requestId":"abcd1234","duration":125}</code>
                        </td>
                        <td>2025-05-22 04:55:12</td>
                    </tr>
                    <tr>
                        <td>1000049</td>
                        <td>0</td>
                        <td><code>srv-auth-02</code></td>
                        <td class="text-truncate" style="max-width:400px;">
                            <code>{"timestamp":"2025-05-22T04:55:10.000Z","level":"WARN","service":"auth-service","message":"Rate limit exceeded","requestId":"efgh5678","duration":350}</code>
                        </td>
                        <td>2025-05-22 04:55:10</td>
                    </tr>
                    <tr>
                        <td>1000048</td>
                        <td>2</td>
                        <td><code>srv-db-01</code></td>
                        <td class="text-truncate" style="max-width:400px;">
                            <code>{"timestamp":"2025-05-22T04:55:08.000Z","level":"ERROR","service":"database","message":"Connection timeout","requestId":"ijkl9012","duration":500}</code>
                        </td>
                        <td>2025-05-22 04:55:08</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="panel panel-primary">
        <div class="panel-heading">
            <h3 class="panel-title"><i class="fa fa-users"></i> Consumer Groups</h3>
        </div>
        <div class="panel-body">
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>Group ID</th>
                        <th>Members</th>
                        <th>Topics</th>
                        <th>Total Lag</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>log-processor-group</strong></td>
                        <td>3</td>
                        <td>logs-topic, app-logs</td>
                        <td>275</td>
                        <td><span class="label label-success">Stable</span></td>
                    </tr>
                    <tr>
                        <td><strong>metrics-analyzer</strong></td>
                        <td>5</td>
                        <td>metrics-topic, system-metrics</td>
                        <td>482</td>
                        <td><span class="label label-success">Stable</span></td>
                    </tr>
                    <tr>
                        <td><strong>clickstream-processor</strong></td>
                        <td>8</td>
                        <td>clickstream-topic</td>
                        <td>8,763</td>
                        <td><span class="label label-warning">Warning</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Simple logging to show the page has loaded
console.log("Simple Bootstrap 3 Kafka Browser loaded");

// Simple script to enhance UI interaction
window.onload = function() {
    console.log("Kafka Browser interface loaded successfully");
    
    // Add hover effect to table rows
    var tableRows = document.querySelectorAll(".table tbody tr");
    if (tableRows) {
        tableRows.forEach(function(row) {
            row.addEventListener("mouseover", function() {
                this.style.backgroundColor = "#f5f5f5";
            });
            row.addEventListener("mouseout", function() {
                this.style.backgroundColor = "";
            });
        });
    }
};
</script>
{% endblock %}